define(["underscore","node","nodeconnectorendmixin","sprites","constants"],function(a,b,c,d,e){var f=b.extend({initialize:function(a){this.constructor.__super__.initialize.apply(this,[a]),this.set({fill:e.endNodeFillColor,stroke:e.endNodeStrokeColor}),this.finishedSprites=new d;var b=this.get("board");this.setupExpectingMarkers(),b.dispatcher.on("connectorStarted",function(){this.startConnectors.length==0&&this.set("highlight",!0)},this),b.dispatcher.on("connectorEnded connectorCancelled",function(){this.set("highlight",!1)},this),b.dispatcher.on("spritesFinished",this.validateFinishedSprites,this)},setupExpectingMarkers:function(){var a=this.get("expecting");for(var b=0;b<a.length;b++){var c=this.getSpriteEndPosition(b);this.get("board").addMarker(c,a[b])}},getSpriteEndPosition:function(a){return{x:(this.get("expecting").length-a)*35+parseInt(this.get("x")),y:parseInt(this.get("y"))+50}},spritePassingOver:function(a){var b=this.get("board");b.activeSprites.remove(a),this.finishedSprites.add(a),b.finishedSprites.add(a)},validateFinishedSprites:function(){var a=this,b=function(){if(a.finishedSprites.length!=a.get("expecting").length)return!1;for(var b=0;b<a.finishedSprites.length;b++)if(a.finishedSprites.at(b).get("fill")!=a.get("expecting")[b])return!1;return!0}();b==0&&(a.get("board").finishedSpritesAreValid=!1)}});return a.extend(f.prototype,c),f})